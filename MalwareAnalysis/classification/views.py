from django.http import HttpResponseRedirect
from django.shortcuts import render

from .forms import HashForm, URLForm, FileForm

from .VTLibrary import handle_uploaded_file, VTHash, VTUrl, VTFile

def index(request):
    formU = URLForm()
    formH = HashForm()
    formF = FileForm()
    return render(request, 'classification/index.html', {'name':"Dashboard", 'formhash':formH, 'formURL':formU, 'formfile':formF})

def informations(request):
	return render(request, 'classification/informations.html', {'name':"Informations"})

def analyze(request):
    if request.method == 'POST':
        formH = HashForm(request.POST)
        formU = URLForm(request.POST)
        formF = FileForm(request.POST)
        name="Virus Total Results - "
        if formH.is_valid():
            h=formH.cleaned_data['h']
            name+=h
            return render(request, 'classification/analyze.html', {'name':name, 'res':VTHash(h)})
        elif formU.is_valid():
            u=formU.cleaned_data['u']
            name+=u
            return render(request, 'classification/analyze.html', {'name':name, 'res':VTUrl(u)})
        elif formF.is_valid():
            f=handle_uploaded_file(request.FILES['f'])
            return render(request, 'classification/analyze.html', {'name':name, 'res':VTFile(f)})
        else:
        	return HttpResponseRedirect('/')
    else:
    	return HttpResponseRedirect('/')