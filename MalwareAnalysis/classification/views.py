from django.http import HttpResponseRedirect
from django.shortcuts import render

from .forms import HashForm, URLForm, FileForm

from .VTLibrary import getVTReport

def handle_uploaded_file(f):
    with open('some/file/name.txt', 'wb+') as destination:
        for chunk in f.chunks():
            destination.write(chunk)

def index(request):
    formU = URLForm()
    formH = HashForm()
    formF = FileForm()
    return render(request, 'classification/index.html', {'name':"Dashboard", 'formhash':formH, 'formURL':formU, 'formfile':formF})

def informations(request):
	return render(request, 'classification/informations.html', {'name':"Informations"})

def analyze(request):
    if request.method == 'POST':
        formH = HashForm(request.POST)
        formU = URLForm(request.POST)
        formF = FileForm(request.POST)
        if formH.is_valid():
        	h = formH.cleaned_data['h']
        	r=getVTReport(h)
        	return render(request, 'classification/analyze.html', {'res':r['permalink']})
        elif formU.is_valid():
        	u=formU.cleaned_data['u']
        elif formF.is_valid():
        	request.FILES['f']
        else:
        	return HttpResponseRedirect('/')
    else:
    	return HttpResponseRedirect('/')